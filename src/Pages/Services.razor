@page "/services"
@using System.Net.Http.Json
@inject HttpClient Http
@inject MetadataService MetadataService

<PageTitle>Services</PageTitle>

<HeroBanner Title="End-to-End Digital Solutions"
    Subtitle="A comprehensive suite of services designed to architect, build, and scale your digital ambitions into market-leading realities."
    TagUser="// DIGITAL_SOLUTIONS" TagPath="// MARKET_LEADING_REALITIES" />

<div class="container">
    <h2>Services</h2>
    <p>We offer a range of services tailored to meet your</p>
</div>

<section class="container py-5">

    @if (services is null)
    {
        <p class="text-center">Loading...</p>
    }
    else
    {
        <div class="row g-0 border-top border-start">
            @foreach (var (s, index) in services.Select((value, i) => (value, i)))
            {
                <div class="col-md-6 col-lg-4 p-4 border-bottom border-end @((index + 1) % 2 == 0 ? "bg-light" : "")">
                    <span class="mono">0@(index + 1).</span>
                    <h3 class="mt-3">@s.title</h3>
                    <p class="opacity-75 small">@s.description</p>
                    @if (s.subservices != null && s.subservices.Length > 0)
                    {
                        <ul class="list-unstyled mt-3">
                            @foreach (var subservice in s.subservices)
                            {
                                <li class="mb-2">
                                    <i class="bi bi-check2 text-accent me-1"></i>
                                    <strong>@subservice.name</strong>
                                    <div class="small text-muted ms-3">@subservice.description</div>
                                </li>
                            }
                        </ul>
                    }
                </div>
            }
        </div>
    }
</section>

@code {
    class Service
    {
        public int id { get; set; }
        public string? title { get; set; }
        public string? description { get; set; }
        public string? icon { get; set; } // New field for the icon
        public Subservice[]? subservices { get; set; } // New field for subservices
    }

    class Subservice
    {
        public string? name { get; set; }
        public string? description { get; set; }
    }

    Service[]? services;

    protected override async Task OnInitializedAsync()
    {
        var defaultMetadata = await MetadataService.GetMetadataAsync();
        var defaultTwitterCard = await MetadataService.GetTwitterCardAsync();
        var defaultOpenGraph = await MetadataService.GetOpenGraphAsync();
        var defaultJsonLd = await MetadataService.GetJsonLdAsync();

        MetadataService.SetPageMetadata(new PageMetadata
        {
            Title = "Services - VVG ONLINE",
            Description = "Digital consulting services to transform your business.",
            Keywords = "services, strategy, innovation, digital transformation",
            Image = "https://github.com/vvgonline/test.vvgonline.net/assets/images//twitter-cards/vvg-online-home-twitter-card.png?raw=true",

            OgType = defaultOpenGraph?.Type ?? "website",
            OgTitle = "Services - VVG ONLINE",
            OgDescription = "Digital consulting services to transform your business.",
            OgImage = "https://github.com/vvgonline/test.vvgonline.net/assets/images//twitter-cards/vvg-online-home-twitter-card.png?raw=true",
            OgUrl = defaultOpenGraph?.Url ?? "https://test.vvgonline.net/services",

            TwitterCard = defaultTwitterCard?.Card ?? "summary_large_image",
            TwitterSite = defaultTwitterCard?.Site ?? "@vvgonline",
            TwitterCreator = defaultTwitterCard?.Creator ?? "@vvgonline",
            TwitterTitle = "Services - VVG ONLINE",
            TwitterDescription = "Digital consulting services to transform your business.",
            TwitterImage = "https://github.com/vvgonline/test.vvgonline.net/assets/images//twitter-cards/vvg-online-home-twitter-card.png?raw=true",
            JsonLd = defaultJsonLd
        });

        var doc = await Http.GetFromJsonAsync<ServiceDoc>("assets/data/services.json");
        services = doc?.services;
    }

    class ServiceDoc { public Service[]? services { get; set; } }
}