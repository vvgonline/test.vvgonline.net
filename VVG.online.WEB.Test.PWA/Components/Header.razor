@inject ThemeService ThemeService
@inject NavigationManager NavManager
@inject LanguageService LanguageService
@implements IDisposable

<header>
    <div class="container site-header">
        <a class="brand" href="/" title="VVG Online">
            <img src="https://avatars.githubusercontent.com/u/47851006?v=4&size=128" alt="VVG ONLINE" loading="lazy" />
        </a>

        <button class="action-btn d-lg-none" @onclick="ToggleNav" aria-label="Open navigation">
            <span class="hamburger">‚ò∞</span>
        </button>

        <nav class="site-nav @(isNavOpen ? "open" : "collapsed")" aria-label="Primary navigation">
            <a href="/" title="Home">Home</a>
            <a href="/services" title="Services">Services</a>
            <a href="/blog" title="Blog">Blog</a>
            <a href="/presentations" title="Presentations">Presentations</a>
        </nav>

        <div class="header-actions">
            <input type="search" placeholder="Search" class="form-control form-control-sm text-light border-0"
                @onchange="OnSearchChanged" aria-label="Search blog posts" />

            <button class="action-btn" @onclick="ToggleTheme" title="Toggle theme">
                @if (ThemeService.CurrentTheme == "light")
                {
                    <span>üåô</span>
                }
                else
                {
                    <span>‚òÄÔ∏è</span>
                }
            </button>

            <button class="action-btn" title="Language" @onclick="ToggleLanguage">
                <span>üåê</span>
                <span class="d-none d-md-inline">@LanguageService.CurrentLanguage</span>
            </button>
        </div>
    </div>
</header>

@code {
    private bool isNavOpen = false;

    void ToggleNav()
    {
        isNavOpen = !isNavOpen;
    }

    void ToggleTheme()
    {
        ThemeService.ToggleTheme();
    }

    void OnSearchChanged(ChangeEventArgs e)
    {
        var searchQuery = e.Value?.ToString();
        NavManager.NavigateTo($"/blog?search={searchQuery}");
    }

    void ToggleLanguage()
    {
        LanguageService.Toggle();
    }

    protected override void OnInitialized()
    {
        LanguageService.OnLanguageChanged += StateHasChanged;
    }

    public void Dispose()
    {
        LanguageService.OnLanguageChanged -= StateHasChanged;
    }
}